(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(3229)}])},3229:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Z}});var r=a(5893),i=a(467),l=a(6351),n=a(7106),o=a(3989),c=a(4646),s=a(3482),d=a(2882),u=a(566),m=a(5107),v=a(1934),p=a(7479),h=a(1851),g=a(3015),f=a(3381),w=a(4562),x=a(9972),y=a(7484),j=a.n(y),b=a(7294),S=()=>{let e="//p1-arco.byteimg.com/tos-cn-i-uwbnlip3yd/e278888093bef8910e829486fb45dd69.png~tplv-uwbnlip3yd-webp.webp",[t,a]=(0,b.useState)(""),[y,S]=(0,b.useState)([]),[Z]=(0,b.useState)({cntKey:"cntSource",infoKey:"cntInfo"}),[L,T]=(0,b.useState)({author:"张三",avatar:e,updateLastTime:""}),[H,Y]=(0,b.useState)(!1),[_,k]=(0,b.useState)(j()(new Date().getTime()).format("YYYY-MM-DD HH:mm:ss")),[N,O]=(0,b.useState)([{uid:"1",url:L.avatar,name:"avatar.png"}]),[E,F]=(0,b.useState)(!1),[I,D]=(0,b.useState)(!1),[C,q]=(0,b.useState)(0),[K]=i.Z.useForm(),M={avatar:"头像",author:"昵称",updateLastTime:"最后修改时间"},P=e=>new Promise((t,a)=>{let r=new FileReader;r.onload=()=>{t(r.result)},r.onerror=e=>{a(e)},r.readAsDataURL(e)}),J=async e=>{var t,a;return e[0].url?e[0].url:(null===(t=e[0])||void 0===t?void 0:t.originFile)?await P(null===(a=e[0])||void 0===a?void 0:a.originFile):""},z=async()=>{try{await K.validate();let e=K.getFieldsValue(),t=await J(e.avatar),a={...e,avatar:t,updateLastTime:j()().format("YYYY-MM-DD HH:mm:ss")};F(!0),setTimeout(()=>{F(!1),T(a),O([{uid:"1",url:a.avatar,name:"avatar.png"}]),l.Z.success("修改成功！"),R(!1),window.localStorage.setItem(Z.infoKey,JSON.stringify(a))},500)}catch(e){console.log({e})}},R=e=>{Y(e)},A=()=>{var e,t,a,r,i,l,n,o;let c=document.body.clientHeight,s=null!==(i=null===(e=document.querySelector(".arco-card .arco-card-header"))||void 0===e?void 0:e.clientHeight)&&void 0!==i?i:0,d=null!==(l=null===(t=document.querySelector(".arco-card .arco-card"))||void 0===t?void 0:t.clientHeight)&&void 0!==l?l:0,u=c-s-d-(null!==(n=null===(a=document.querySelector(".arco-card .arco-space-item .arco-input-group-wrapper"))||void 0===a?void 0:a.clientHeight)&&void 0!==n?n:0)-(null!==(o=null===(r=document.querySelector(".arco-card .arco-space-item .arco-list-header"))||void 0===r?void 0:r.clientHeight)&&void 0!==o?o:0)-64;q(u),console.log({viewH:c,remainingHeight:u,headH:s,outH:64})};return(0,b.useEffect)(()=>{let e=window.localStorage.getItem(Z.cntKey),t=window.localStorage.getItem(Z.infoKey);e&&S(JSON.parse(e)),t&&(O([{uid:"1",url:JSON.parse(t).avatar,name:"avatar.png"}]),T(JSON.parse(t)));let a=setInterval(()=>{k(j()(new Date().getTime()).format("YYYY-MM-DD HH:mm:ss"))},1e3);return D(!0),setTimeout(()=>{A()}),window.addEventListener("resize",A),()=>{clearInterval(a),window.removeEventListener("resize",A)}},[]),(0,b.useEffect)(()=>{y.length>0&&Z&&window.localStorage.setItem(Z.cntKey,JSON.stringify(y))},[Z,y]),(0,r.jsx)(r.Fragment,{children:I?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(n.Z,{title:(0,r.jsx)("div",{suppressHydrationWarning:!0,children:_}),extra:(0,r.jsx)(o.Z,{focusLock:!0,title:"提示",content:"是否确定要清除数据?",onOk:()=>{Object.values(Z).forEach(e=>{window.localStorage.removeItem(e)}),S([]),O([{uid:"1",url:e,name:"avatar.png"}]),a(""),T({author:"张三",avatar:"//p1-arco.byteimg.com/tos-cn-i-uwbnlip3yd/e278888093bef8910e829486fb45dd69.png~tplv-uwbnlip3yd-webp.webp",updateLastTime:""})},children:(0,r.jsx)(c.Z,{type:"primary",children:"清除数据"},"clear")}),children:(0,r.jsxs)(s.Z,{direction:"vertical",style:{width:"100%"},children:[H?(0,r.jsxs)(i.Z,{form:K,initialValues:{author:L.author},labelAlign:"left",autoComplete:"off",children:[(0,r.jsx)(x.Z,{label:"昵称",field:"author",rules:[{required:!0,message:"请输入您的昵称"}],children:(0,r.jsx)(d.Z,{placeholder:"请输入您的昵称"})}),(0,r.jsx)(i.Z.Item,{label:"头像",field:"avatar",triggerPropName:"fileList",rules:[{required:!0,message:"请上传头像"}],initialValue:N,children:(0,r.jsx)(u.Z,{listType:"picture-card",multiple:!0,name:"files",action:"#",limit:1,fileList:N,accept:"image/*",onChange:O,onPreview:e=>{m.Z.info({title:"预览",content:(0,r.jsx)(v.Z,{src:e.url||e.originFile&&URL.createObjectURL(null==e?void 0:e.originFile),style:{maxWidth:"300px"},alt:"uploadAvatar"})})}})}),(0,r.jsx)(x.Z,{label:" ",children:(0,r.jsxs)(s.Z,{children:[(0,r.jsx)(c.Z,{loading:E,onClick:()=>R(!1),children:"取消"}),(0,r.jsx)(c.Z,{loading:E,type:"primary",onClick:z,children:"提交"})]})})]}):(0,r.jsx)(n.Z,{title:"用户信息",hoverable:!0,extra:(0,r.jsx)(c.Z,{type:"text",onClick:()=>R(!0),children:"编辑"}),actions:[L.updateLastTime&&(0,r.jsx)("span",{style:{color:"#86909c",fontSize:12},children:"最后修改时间：".concat(L.updateLastTime)},"time")],children:(0,r.jsx)(p.Z,{title:!1,data:Object.keys(L).filter(e=>"updateLastTime"!==e).map(e=>({label:M[e],value:"avatar"===e?(0,r.jsx)(h.Z,{style:{background:"transparent"},children:(0,r.jsx)(v.Z,{src:L[e],alt:e})}):L[e]})),layout:"horizontal",border:!0,column:5})}),(0,r.jsx)(d.Z.Search,{searchButton:!0,placeholder:"请输入内容",value:t,onChange:a,onSearch:()=>{if(!t.trim())return l.Z.error("请输入要发送的内容");let e={dateTime:_,content:t,...L};S(t=>[...t,e]),a("")}}),(0,r.jsx)(g.Z,{bordered:!1,header:(0,r.jsxs)("span",{children:[y.length," 条记录清单"]}),virtualListProps:{height:C},children:y.map((e,t)=>{var a,i,l,n,o;return(0,r.jsx)(g.Z.Item,{children:(0,r.jsx)(f.Z,{align:"right",author:null!==(a=null==e?void 0:e.author)&&void 0!==a&&a,avatar:null!==(i=null==e?void 0:e.avatar)&&void 0!==i&&i,content:null!==(l=null==e?void 0:e.content)&&void 0!==l?l:e,datetime:null!==(n=null==e?void 0:e.dateTime)&&void 0!==n&&n})},null!==(o=null==e?void 0:e.id)&&void 0!==o?o:t)})})]})})}):(0,r.jsx)(w.Z,{})})},Z=()=>(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(S,{})})}},function(e){e.O(0,[832,974,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);